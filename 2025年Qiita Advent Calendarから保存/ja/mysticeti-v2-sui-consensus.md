---
title:  Mysticeti v2: より高速・軽量なSuiトランザクション処理 [Sui Foundation Blog]
tags: SUI Web3 Blockchain Mysticeti 有向非巡回グラフ
author: nft
slide: false
---
Mysten Labsのエンジニアが、Mysticeti v2でSuiのコンセンサスをどのように改良し、よりスマートで効率的なトランザクション処理を実現したのかを内部から解説。
![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/1926720/633f2e50-c2da-4467-88f9-02549851ab63.png)

*著者: Tasos Kichidis (Software Engineer), Lefteris Kokoris-Kogias (Research Scientist), Arun Koshy (Software Engineer), Maxwell Tian (Software Engineer)*

:::note
元記事: [Mysticeti v2: Faster and Lighter Sui Transaction Processing](https://blog.sui.io/mysticeti-v2-sui-consensus/)
:::

[Mysticeti](https://sui.io/mysticeti?ref=blog.sui.io)は、Suiを支えるコンセンサスプロトコルです。2024年7月にMainnetで初めてローンチされ、[有向非巡回グラフ(DAG)](https://blog.sui.io/all-about-directed-acyclic-graphs/)に基づいた新世代の高性能コンセンサスを導入しました。この設計により、Suiは業界をリードする応答性、低レイテンシ、スケーラビリティを実現しました。

Mysticeti v2により、私たちは次の大きな前進を遂げています。

このバージョンは、トランザクション検証をコンセンサスプロセスに直接統合し、以前は計算コストとレイテンシを追加していた冗長なステップを削除します。また、Transaction Driverと呼ばれるより効率的なクライアントメカニズムを導入し、トランザクションがネットワーク上で送信および確認される方法を簡素化します。

これらのアップデートにより、トランザクション処理が大幅に高速化、軽量化され、回復力が向上し、Mysticetiが設計された完全なパフォーマンスポテンシャルを実現します。

## DAGベースコンセンサスの進化

何が変わったのか、そしてこれらの改善がなぜ重要なのかを理解するには、DAGベースのコンセンサスプロトコルが時間とともにどのように進化してきたかを見ると役立ちます。

### 従来のコンセンサスプロトコル

バリデータは順番にブロックとトランザクションを提案します。コンセンサススループット、レイテンシ、バリデータ委員会サイズの間にはトレードオフがあります。

*例: Tendermint, Hotstuff*

### 認証済みDAG上のMempoolとコンセンサス

すべてのバリデータは、トランザクションを含むブロックをほぼ継続的に提案します。ブロックは最初に認証され、次にコミットされます。これにより、トランザクションの配信と順序付けが分離され、バリデータセットがスケールしてもスループットが維持されます。並列提案により、バリデータのサブセットがトランザクションがコンセンサスに送信されることを拒否することが難しくなるため、検閲耐性も向上します。

*例: Narwhal & Bullshark*

### 未認証DAG上のコンセンサス

未認証DAGプロトコルは、アルゴリズムの複雑さとブロックをコミットするために必要なラウンド数をさらに削減するために、認証ステップを削除します。

*例: Mysticeti*

Mysticetiは、Sui上でレスポンシブなユーザーエクスペリエンスを提供することに非常に成功しています。Mysticetiはその動作モデルの下で可能な限り低いコンセンサスレイテンシを達成していますが、Suiとの統合はまだその完全なポテンシャルを実現していません。

Suiトランザクション処理には、トランザクションがコンセンサスに受け入れられるべきかどうかをバリデータが投票する追加のコンセンサス前ステップがあります。トランザクションは、古い入力データの使用から無効なMoveパッケージの公開の試みまで、様々な理由で拒否される可能性があります。

トランザクションは、ステークの3分の2以上のバリデータからの投票(クォーラム)がある場合にのみ実行できます。このステップにより、Suiバリデータ委員会は、すべてのバリデータからの同一のアクションを必要とせずに、トランザクションをフィルタリングする権限を持ちます(ステークの3分の1以上の投票がトランザクションを拒否できるため)。

このメカニズムは、Sui上の「fastpath」もサポートします。これにより、Owned Objectのみに触れるトランザクションは、コンセンサスを必要とせずに高速にファイナライズできます。しかし、このコンセンサス前ステップは、各トランザクションの検証に大きな計算コストを追加し、非fastpathトランザクションのレイテンシも増加させます。

私たちは、このステップをMysticetiにマージし、関連するすべてのコストを排除することに取り組んできました。[Mysticeti論文](https://docs.sui.io/paper/mysticeti.pdf?ref=blog.sui.io)はMysticeti-FPCプロトコルを導入し、追加の計算コストを削除しました。Mysticeti v1のローンチ後、レイテンシオーバーヘッドの排除にも焦点を当てました。この作業はMysticeti v2で最高潮に達し、Mysticetiの完全なパフォーマンスの約束を実現し、Suiネットワークに必要なすべての機能をサポートします。

## Mysticeti v2の仕組み

Mysticeti v2は、Mysticeti v1の代替ではなく、その上の拡張です。

Mysticetiでは、各ラウンドで1つ以上のリーダーまたはアンカーブロックが選択されます。DAG上で「コミットルール」を実行すると、アンカーをコミットするかスキップするかが決定されます。次に、新しくコミットされたアンカーによって接続された未コミットブロックが新しいコミットを形成します。

コミットルールは、Mysticeti v1とv2の間で変わりません。アンカーブロックをコミットするための最も一般的なケースは、クォーラム(委員会ステークの3分の2以上)の証明書があり、各証明書がアンカーに対するクォーラムの投票を持っている場合です。これは*直接コミット*と呼ばれます。別のケースは*間接コミット*で、後の(ラウンド≥R+3)直接コミットされたアンカーによって接続されたブロック内の以前のアンカー(ラウンドR)を指す証明書が少なくとも1つある場合です。

![](https://blog.sui.io/content/images/2025/11/data-src-image-87cbc881-7ec4-4b58-9028-41ca8b8baa8a.png)

MysticetiのDAGコンセンサス:バリデータがブロックを提案、投票、認証して検証可能な証明書を形成します。

Mysticeti v2では、概念的に、Mysticetiリーダーコミットルールがすべてのトランザクションに同時に適用されるように拡張されます。各トランザクションはファイナライズまたは拒否され、同じDAG上でブロックはコミットまたはスキップされるように決定されます。

トランザクションは、ファイナライゼーション証明書のクォーラムがある場合にファイナライズされます。各ファイナライゼーション証明書ブロックは、トランザクションを受け入れる(投票する)以前のラウンドブロックのクォーラムに接続されています。Mysticetiコミットルールとは異なり、トランザクションに投票または認証するブロックは、トランザクションを含むブロックよりもずっと後のラウンドにある可能性があります。

トランザクションをファイナライズする別の方法は、間接コミットに似ています—トランザクションの証明書がコミットされたブロックに含まれている場合です。トランザクションが拒否投票のクォーラムを観察すると、それは拒否されます。トランザクション*T*が、トランザクションを含む最初のコミット*C₁*の後にアンカーが3ラウンド以上あるコミット*C₂*を観察した後にファイナライズされない場合、*T*も拒否されます。

しかし、Mysticeti v2アルゴリズムの素朴な実装は、500,000トランザクションの処理にスケールしません。バリデータがすべてのトランザクションに明示的な投票を行うと、ネットワークトラフィックが増幅され、全体的なスループットが低下します。各トランザクションに証明書のクォーラムがあるかどうかを評価することも計算コストが高く、ネットワーク全体でのブロック伝播が不均一になる可能性があります。

これらの課題に対処するために、Mysticeti v2アルゴリズムを最適化しました。バリデータは、拒否に対してのみ明示的な投票を行うようになりました。受け入れ投票は、祖先ブロックリンクを介して暗黙的です。トランザクション認証は、必要な場合にのみ評価されます。プロトコルはまた、複数のラウンドがトランザクションに投票および認証することを許可し、ネットワーク接続が弱いバリデータを介して送信された有効なトランザクションでもファイナライズできるようにします。

## Transaction Driver: より効率的なトランザクションクライアント

Mysticeti v2により、バリデータへのトランザクション送信がより簡単かつ効率的になります。

Quorum Driverは、Mysticeti v1にトランザクションを送信するための元のメカニズムでした。これは、すべてのトランザクションをすべてのバリデータにブロードキャストして認証し、各トランザクションの有効性にBLS署名を収集することで機能しました。署名集約後、認証されたトランザクションをコンセンサス送信のために再ブロードキャストし、すべてのバリデータから再度実行結果を収集しました。

この設計は、元のコンセンサスレスfastpathに必要でしたが、高いCPUコスト(ステークの少なくとも3分の2のバリデータがすべてのトランザクションに署名する必要がありました)と、各トランザクションが2回ブロードキャストされるため、帯域幅の使用量が多いという問題がありました。

Transaction Driverは、高速ファイナリティを維持しながら、これらの問題を解決します。Mysticeti v2によって導入された新しいトランザクション認証パスを活用して、はるかに少ないオーバーヘッドで同じ目標を達成します。

主な改善点は以下の通りです:

1. 最小限のバリデータ署名: バリデータは、個別に署名するのではなく、コンセンサスブロック署名の一部としてトランザクションの有効性に署名し、複数のトランザクションをまとめてバッチ処理するようになりました。これにより、CPU負荷が劇的に削減されます。
2. シングルパス送信: クライアントは、すべてのバリデータではなく、選択された単一のバリデータに各トランザクションを送信し、効果の完全なコピーを1つ取得するようになりました。これにより、ネットワーク使用量がほぼ最適なレベルに削減されます。
3. スマートバリデータ選択: ドライバーは、より高速な確認のために、履歴エンドツーエンドレイテンシに基づいてバリデータを自動的に選択します。
4. 優雅な再試行と回復力: 選択されたバリデータが遅いまたはオフラインの場合、クライアントは自動的に他のバリデータで再試行し、ステークの少なくとも3分の1のバリデータをターゲットにします。エラーは再試行可能または再試行不可能として分類され、フィードバックが返される前に成功完了の可能性を最大化します。
5. 帯域幅保護とDoS耐性: Transaction Driverは、スパムまたは帯域幅増幅攻撃を防ぐために、バリデータ側の保護と統合されています。

Transaction Driverは、選択されたバリデータにトランザクションを送信し、コンセンサスでの位置を受信し、トランザクションダイジェストとコンセンサス位置を使用してバリデータのクォーラムでその完全な効果を取得および認証することでこれを実現します。

## ロールアウト

Transaction Driverは、Mysten Labsおよびいくつかのパートナーチームが運営するFull Node上のすべてのトラフィックで有効になっています。アジアベースのFull Nodeで35%のレイテンシ削減(〜1.00秒から〜0.65秒)、ヨーロッパベースのFull Nodeで25%の削減(〜0.55秒から〜0.40秒)を観察しました。

![](https://blog.sui.io/content/images/2025/11/data-src-image-1deaed49-063b-48f6-b9db-2f6a8db04bca.png)

Transaction Driver(黄色)とQuorum Driver(緑色)を使用したアジアベースのFull Nodeでのレイテンシ比較、パフォーマンスの向上を示しています

![](https://blog.sui.io/content/images/2025/11/data-src-image-74aeb7b0-3d20-4ab0-813d-9f37519f3bb6.png)

Transaction Driver(黄色)とQuorum Driver(緑色)を使用したヨーロッパベースのFull Nodeでのレイテンシ比較、パフォーマンスの向上を示しています。

Sui node v1.60以降、Mysticeti v2とTransaction Driverがトランザクション処理のデフォルトになります。

## その他の変更

Mysticeti v2の一部として導入されたいくつかの他の改善は、以前にロールアウトされ、今後のブログ投稿で取り上げられる予定です:

* ガベージコレクション: 古いコンセンサスブロックはコミットされずにドロップされ、ブロックを効率的に伝播できないバリデータのパフォーマンスへの影響を制限します。
* スマート祖先選択: ブロックを一貫してブロードキャストしないバリデータは、リンクの祖先として除外されます。

## 今後の取り組み

Suiコンセンサスを改善する取り組みは継続中です。

次のフェーズでは、トランザクションをコミットするために必要なメッセージラウンドの中央値を削減すること(4ラウンドから3ラウンドへ)に焦点を当て、スループットと応答性をさらに改善します。

もう1つの重要な目標は、コンセンサスブロックをFull Nodeに直接ストリーミングできるようにすることで、未コミットトランザクションへのアクセスを提供し、エンドツーエンドのレイテンシをさらに削減することです。

並行して、プロトコルレベルでOwned Objectの「デッドロック」を防ぐための取り組みが進行中であり、すべてのObjectタイプにわたってシームレスなトランザクション実行を確保します。

これらのプロジェクトが進展するにつれて、さらなるアップデートを共有することを楽しみにしています。
