[Seal: Programmable Access Control for Real-World Apps](https://blog.sui.io/seal-programmable-access-control/)

## Sui上のMEV:現状と次のステップ

SuiでのMEVの仕組み—トランザクションの順序付け、保護、公正な競争のためのメカニズム。

* [![Mysten Labs](https://blog.sui.io/content/images/size/w100/2023/11/MystenLabs_Logomark_Red-4.png)](https://blog.sui.io/author/mysten/)

![MEV on Sui: Current State and Next Steps](https://blog.sui.io/content/images/size/w2000/2025/02/02-49-Blog-Header.png)

Maximum Extractable Value(MEV)は、トランザクションの順序付けとアービトラージの機会を扱うため、ブロックチェーン業界で大きなトピックになっています。透明性の確保、トランザクションの保護、健全なネットワークの維持、参加者への報酬のために、私たちはSui上のMEVをガイドするためのSui改善提案(SIP)やその他のメカニズムを慎重に実装してきました。

現在のメカニズムに加えて、Sui上のMEVの進化を私たちの高レベルの原則がガイドすることを保証するために、さらに構築する予定です。

## 設計原則と考慮事項

Sui上のすべての取引は、潜在的な利益機会を持つ新しい情報を導入します。Sui上のMEVエコシステムは、いくつかのメカニズムによって形成されています:

1. **MEVトランザクションを提出する**メカニズム。
2. **MEV機会を広める**メカニズム。
3. **MEV収益を分配する**メカニズム。
4. **ユーザートランザクションを保護する**メカニズム。

私たちの一般的な優先事項は以下の通りです:

1. ユーザーの**トランザクション保護**は、抽出された価値の量よりも重要です。より大きな抽出価値よりも小さなスリッページを優先します。オプトアウトの方法がないレイテンシを増加させるプロトコル外のオークションを避けます。
2. **ネットワークの透明性**は、バリデータやリレイヤーとのオフライン取引よりも望ましいです。
3. **優先ガスオークション(PGA)を介した競争**を優先し、システムの非効率性につながるスパム行動を阻止します:私たちが目指している完璧なシステムは、サーチャーが抽出された価値によって決定される優先手数料を持つトランザクションを送信することを支配的な戦略にします。
4. エコシステムに整合した参加者への**報酬分配**を奨励します:バリデータ、ステーカー、アプリ、ユーザー。

## トランザクションの提出

同じObjectを変更するトランザクションは順次実行されるため、クライアントは実行順序の可能性を高めるために競争します。システムの観点から、**優先ガスオークション(PGA)**は、リソースを割り当て、スパムを防ぎながら、参加者間でガス料金を再分配する効率的な方法です。

優先ガスオークションの主要な推進力は**量子化された実行**です:

* コンセンサスによって順序付けられたトランザクションは、ブロックで処理されます。トレーダーは、ガスオークションを介してコミット**内**と**間**の両方で優先順位を競います。
* これは、実行の優先順位が純粋に速度に依存するCEXマーケットメーカーとは対照的であり、低レイテンシネットワーキングとアルゴリズムによって達成されます。
* より高いコンセンサスコミットレートは**量子化効果を減少させ**、DEX実行をより効率的にしますが、PGAウィンドウを狭めます。
* 現在、混雑していないObjectのPGAは、最速のサーチャーにのみ重要です。**15コミット/秒**のSuiレートでは、トランザクション提出速度における70ミリ秒の優位性が決定的要因です。
  * 混雑したObjectは、トランザクション実行を延期する可能性があり、競合するトランザクションのウィンドウが通常のコンセンサスコミットの潜在的に10倍に成長するため、PGAの重要性が増幅されます。

特定の今後のSuiコミットに向けてトランザクションを誘導するための2つの別々のメカニズムがあります:

### ソフトバンドル内のトランザクションのバッチを提出する:[SIP-19](https://github.com/sui-foundation/sips/blob/main/sips/sip-19.md?ref=blog.sui.io)

1. ソフトバンドルを介して提出されたトランザクションは、有効なバンドルに対して高い確率で同じコンセンサスコミットに含まれます。バンドルの有効性条件には、とりわけ、すべてのトランザクションの同一のガス価格が必要です。
2. 実際には、このメカニズムは、元のトランザクションとそのバックラントランザクションをバンドルするためのオフチェーンオークションを可能にします。例えば、[Shio](https://www.getshio.com/explorer?ref=blog.sui.io)によって実行されているものなどです。

### コンセンサス増幅を介したトランザクションの優先順位付け:[SIP-45](https://github.com/sui-foundation/sips/blob/main/sips/sip-45.md?ref=blog.sui.io)

1. SIP-45は、より高いガス価格を持つトランザクションが、同時に提出されたより低いガス価格のトランザクションよりも後のコミットで順序付けられる、コンセンサス提出における潜在的なジッターの問題に取り組んでいます。
2. コンセンサス提出には2つの自然なジッターソースがあります:
   1. 提出しているバリデータがいくつかのコンセンサスラウンド遅れている:別のバリデータによって提出されたトランザクションが最初に順序付けられる可能性があります。
   2. コンセンサスラウンドのリーダーであるバリデータは、他のバリデータの提出に対して1ラウンドの優位性を持っています。
3. SIP-45は、k x RGP(kは現在の構成で5に設定されているシステムパラメータであり、RGPはReference Gas Price)よりも高いガス価格のコンセンサス提出を増幅します。n x RGPのガス価格を持つトランザクションは、n回増幅されます。
4. アプリビルダーとユーザーの両方による**SIP-45のより広範な採用**は、公正な競争を伴うより効率的なシステムを作成します。
   1. SIP-45はクライアントの観点からシステムの基本的なプロパティを変更しないことに注意することが重要です:**より効率的な代替案を提供することでスパムを阻止します**。

### トランザクションの適切なガス価格を選択する

提出されたトランザクションのガス価格を決定するためにクライアントが考慮すべき2つの主要な要因があります:

1. **優先ガスオークション。**
   * コンセンサスコミット内で、同じObjectを変更するトランザクションは**ガス価格によって順序付けられ**、サーチャー間で公正な競争を生み出します。
2. **コンセンサス提出の増幅。**
   * 上記のように、5 x RGPを超えるガス価格は、与えられたトランザクションをコンセンサスに提出するnバリデータで**コンセンサス提出を増幅**します。増幅閾値を超えるガス価格の増加は、低パフォーマー提出ジッターの確率を減らします。実際には、5の増幅係数はジッターを排除するのに十分ですが、100 x RGPのガス価格は高い確率で次のラウンドのリーダー提出を解放します。
3. **混雑の延期とキャンセルを回避する。**
   * Suiは、同じShared Objectを変更するトランザクションのレートを制御することで、チェックポイント実行のウォールクロック時間を制限します。混雑したObjectを変更するトランザクションは、ガス価格に従って順序付けられ、チェックポイントごとの順次実行の最長チェーンを制限するために、低価格のトランザクションが延期され、最終的にキャンセルされます。これは[**オブジェクトベースのローカル手数料市場**](https://docs.sui.io/guides/developer/advanced/local-fee-markets?ref=blog.sui.io)と呼ばれるメカニズムです。*(高いアービトラージ機会を提供するShared Objectに対してガス価格が急上昇する可能性がある一方で、システムの残りの部分では変わらないことに注意してください。)*
   * Full Nodeは、混雑したObjectを変更する、実行されたトランザクションとキャンセルされたトランザクションの両方のガス価格を追跡します。したがって、**トランザクションのドライラン結果**には、与えられたリクエストによって変更された混雑したObjectに対する、最低価格で実行されたトランザクションと最高価格でキャンセルされたトランザクションのガス価格の両方を含めることができます。この情報により、クライアントは高い確率で延期を回避するために必要なガス価格を決定できます。*(この作業は部分的にのみ実装されており、今後2か月以内にSDKの一部になる予定です。)*

## トランザクション情報の広め方

Sui上の各トランザクションは、潜在的な利益機会を持つ情報を導入します。クライアントによって提出された瞬間からその効果が第三者によって観察されるまでの、Shared Objectトランザクションのハッピーパスのライフサイクルを考えてみましょう:

![](https://blog.sui.io/content/images/2025/02/mermaid-diagram-2025-02-25-130957--1-.png)

1. クライアントがRPC Full Node(通常はアプリによって選択される)にトランザクションを提出します。
2. RPCノードがトランザクションをバリデータにブロードキャストし、バリデータがその有効性を検証して署名し、RPCノードがクォーラムからトランザクション証明書を組み立てます。
3. RPCノードがトランザクション証明書をバリデータにブロードキャストします。
4. 決定論的に選択されたバリデータがトランザクションをコンセンサスに提出します。Mysticetiコンセンサスはバリデータ間でブロックをブロードキャストし、3コンセンサスラウンドで、与えられたトランザクションを持つブロックがコミットされます。
   1. トランザクションは各バリデータで実行されます
5. トランザクション効果証明書がRPCノードとクライアントに送り返されます。
6. 1〜3コンセンサスラウンド内に、各バリデータがチェックポイントを形成して署名します(チェックポイントは複数のコンセンサスコミットをバッチ処理します)。
7. チェックポイント署名がバリデータ間でブロードキャストされ、各バリデータがチェックポイント証明書を形成します。
8. ステート同期プロトコルは、認証されたチェックポイントをp2p方式で広めることを担当します。通常、各バリデータには、RPCリクエストを提供しない直接のピアがあります:ステート同期Full Nodeで、最初にチェックポイントを受信します。
9. ステート同期Full Nodeに接続されている第三者Full Nodeがチェックポイントについて知り、そのコンテンツをダウンロードします。この時点で、Full Nodeに直接接続されている第三者がこのトランザクションの効果を後処理し、それに応じて反応できると仮定します。

### バリデータ提出前のトランザクション情報の広め方

前のセクションで説明したように、[SIP-19](https://github.com/sui-foundation/sips/blob/main/sips/sip-19.md?ref=blog.sui.io)に従ってソフトバンドルを提出するためのSuiオフチェーンオークションがあります。これらのオークションは、**アプリとオークションシステム間のオフチェーン契約**を介してトランザクション提出を傍受します。例えば、[Shio](https://www.getshio.com/explorer?ref=blog.sui.io)によって実行されているものなどです。

このタイプの情報の広め方は、潜在的なサンドイッチ攻撃からユーザートランザクションを保護する良識のあるオークションシステムを前提としています。Shioは、ビジネスを維持するためにユーザートランザクションを保護するインセンティブがあるため、潜在的なサンドイッチボットの財務的収益性を損なうために多数のオークション技術(おとりトランザクション、ランダム遅延)を採用しています。

明らかに、このタイプの情報の広め方はSuiの外で発生し(アプリとオークション間)、アプリとユーザーにとってオプトインであり、元のユーザートランザクションが成功する保証なしに、投機的な情報のみを提供します。

### コンセンサスブロックのストリーミング

ユーザートランザクションへの低遅延アクセスを民主化するために、コンセンサスブロックの直接ストリーミングのためのシステムを設計しています。高レベルでは、Full Nodeはコンセンサスブロックに直接サブスクライブするオプションを持つことになります。

このようにして、Full Nodeは高い確率でコミットされるトランザクションについて投機的に通知するオプションを持つことになります。ネットワークトポロジは、標準のオープンなステート同期ピア発見プロトコルを使用しています。

投機的な通知は、バリデータ提出から約160ミリ秒(2コンセンサスラウンド)でトランザクションに関する伝播遅延を大幅に短縮する可能性があります。

コンセンサスブロックストリーミングプロジェクトは現在設計段階にあり、今後1〜2か月以内にSIPを持つことを期待しています。

## ユーザートランザクションの保護

ユーザートランザクションは、略奪的なフロントランニング、サンドイッチング、不本意な提出遅延から保護される必要があります。

### 外部クォーラム駆動

Suiトランザクション提出には外部クォーラム駆動が必要であり、これは通常Full Nodeによって実行されます。

![](https://blog.sui.io/content/images/2025/02/image.png)

トランザクションtのトランザクション提出リクエストを受信するバリデータが新しいトランザクションt'を開始したい場合、元のクォーラムドライバーの証明書組み立てプロセスで遅れをとることになります。提出するFull NodeがSuiクォーラムに不十分に接続されていない限り、元のトランザクションに応答してt'のクォーラム駆動を開始するバリデータは、tの後に証明書を組み立てます。

さらに、tのコンセンサス提出は分散化されているため、その証明書がクォーラムに到達すると、確実に延期することはできません。したがって、tの証明書がt'の証明書の前にSuiクォーラムに到達した場合、tは高い確率でt'の前に決済されます。

したがって、外部クォーラム駆動という事実自体が、トランザクション提出を担当するFull Nodeへの信頼を前提として、自然なフロントランニング保護を提供します(フロントランニングの略奪的な試みはオンチェーンで簡単に検出されるため、これらの試みはクライアントによって注目され、RPCオペレーターの評判を傷つけます)。

### Mysticetiファストパス

現在、Mysticeti[論文](https://arxiv.org/abs/2310.14821?ref=blog.sui.io)で説明されているファストパスプロトコルにトランザクション提出を変更するプロジェクトに取り組んでいます。このプロトコルによれば、ユーザートランザクションは単一のバリデータに提出でき、それがトランザクション証明書の収集と実行のためにMysticetiを活用します。システムを大幅に効率的にする一方で、ユーザートランザクションを受信するバリデータのフロントランニング機会を開きます。

このリスクは純粋に仮説的です。今日のSuiにはフロントランニングの試みの証拠がないためです。新しいセットアップでは、フロントランの可能性は高くなりますが、他方で、提出するバリデータについての決定論的な知識があるため、彼らに責任を持たせることが容易になります。

## Suiの進化するMEVランドスケープ

Suiのメカニズムは今年後半にさらに登場する予定で、SuiのMEVランドスケープはまだ形成中です。優先ガスオークションとコンセンサス増幅が現在のシステムを定義する一方で、タイムロック暗号化やMysticetiのファストパスのような今後のイノベーションは、トランザクション実行とセキュリティを再形成します。これらの要素がオンラインになるにつれて、Sui上のMEVは進化し続け、より動的で透明性の高いエコシステムを作成します。
