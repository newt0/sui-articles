[Big Ideas, Bold Pitches: Inside Sui Tank with Kevin O'Leary](https://blog.sui.io/sui-tank-suifest-2025/)

## MEV on Sui: 現状と次のステップ

SuiにおけるMEVの仕組み—トランザクション順序付け、保護、公正な競争のメカニズム。

* [![Mysten Labs](https://blog.sui.io/content/images/size/w100/2023/11/MystenLabs_Logomark_Red-4.png)](https://blog.sui.io/author/mysten/)

![MEV on Sui: Current State and Next Steps](https://blog.sui.io/content/images/size/w2000/2025/02/02-49-Blog-Header.png)

Maximum extractable value(MEV)は、トランザクションの順序付けと裁定機会を扱うため、ブロックチェーン業界において大きなトピックとなっています。透明性の確保、トランザクションの保護、健全なネットワークの維持、参加者への報酬を目的として、私たちはSui improvement proposals(SIPs)やその他のメカニズムを慎重に実装し、Sui上のMEVを導いてきました。

現在のメカニズムに加えて、私たちはSui上のMEVの進化を導く高レベルの原則を確実に実現するために、さらなる構築を計画しています。

## 設計原則と考慮事項

Sui上のすべての取引は、潜在的な利益機会を伴う新しい情報をもたらします。Sui上のMEVエコシステムは、いくつかのメカニズムによって形成されています:

1. **MEVトランザクションを送信する**ためのメカニズム
2. **MEV機会を配信する**ためのメカニズム
3. **MEV収益を分配する**ためのメカニズム
4. **ユーザートランザクションを保護する**ためのメカニズム

私たちの一般的な優先事項は以下の通りです:

1. ユーザーの**トランザクション保護**は、抽出される価値の量よりも重要です。抽出される価値を大きくすることよりも、スリッページを小さくすることを優先します。オプトアウトする方法がなく、レイテンシを増加させるプロトコル外のオークションを避けます。
2. **ネットワークの透明性**は、バリデータやリレイヤーとのオフライン取引よりも望ましいです。
3. **priority gas auctions(PGA)** による競争を優先し、システムの非効率性につながるスパム行為を抑制します:私たちが目指す完璧なシステムは、サーチャーが抽出される価値によって決定される優先手数料を含むトランザクションを送信することを支配的戦略とするものです。
4. エコシステムに貢献する参加者への**報酬の分配**を奨励します:バリデータ、ステーキング参加者、アプリ、ユーザーへの報酬分配です。

## トランザクションの送信

同じObjectを変更するトランザクションは順次実行されるため、クライアントは実行順序の確率を高めるために競争します。システムの観点から、**priority gas auctions(PGA)** は、リソースを割り当て、スパムを防ぎながら、参加者間でガス料金を再分配する効率的な方法です。

priority gas auctionsの主要な推進力は**量子化された実行**です:

* コンセンサスによって順序付けられたトランザクションは、ブロック単位で処理されます。トレーダーは、ガスオークションを通じて、コミット**内**およびコミット**間**の両方で優先順位を競います。
* これは、実行の優先順位が純粋に速度に依存するCEXのマーケットメーカーとは対照的です。CEXでは低レイテンシのネットワークとアルゴリズムによって達成されます。
* コンセンサスのコミット率が高いほど、**量子化効果が減少**し、DEXの実行がより効率的になりますが、PGAのウィンドウは狭くなります。
* 現在、混雑していないObjectのPGAは、最速のサーチャーにとってのみ重要です。**15コミット/秒**のSuiレートでは、トランザクション送信速度における70ミリ秒のアドバンテージが勝敗を分けます。
  * 混雑したObjectは、トランザクション実行を遅延させる可能性があり、競合するトランザクションのウィンドウが通常のコンセンサスコミットの潜在的に10倍まで拡大するため、PGAの重要性が増幅されます。

特定の今後のSuiコミットに向けてトランザクションを誘導するための2つの独立したメカニズムがあります:

### soft bundle内でトランザクションのバッチを送信する: [SIP-19](https://github.com/sui-foundation/sips/blob/main/sips/sip-19.md?ref=blog.sui.io)

1. soft bundleを介して送信されたトランザクションは、有効なbundleに対して高い確率で同じコンセンサスコミットに含まれます。Bundleの有効性条件には、とりわけ、すべてのトランザクションで同一のガス価格が必要です。
2. 実際には、このメカニズムは、元のトランザクションとそのバックランニングトランザクションをバンドルするためのオフチェーンオークションを可能にします。例えば、[Shio](https://www.getshio.com/explorer?ref=blog.sui.io)が運営しているものです。

### コンセンサス増幅によるトランザクションの優先順位付け: [SIP-45](https://github.com/sui-foundation/sips/blob/main/sips/sip-45.md?ref=blog.sui.io)

1. SIP-45は、同時に送信された低いガス価格のトランザクションよりも、高いガス価格のトランザクションが後のコミットで順序付けられるという、コンセンサス送信における潜在的なジッターの問題に取り組んでいます。
2. コンセンサス送信には2つの自然なジッター源があります:
   1. 送信するバリデータがいくつかのコンセンサスラウンド遅れている:別のバリデータによって送信されたトランザクションが先に順序付けされる可能性があります。
   2. コンセンサスラウンドのリーダーであるバリデータは、他のバリデータの送信に対して1ラウンドのアドバンテージを持っています。
3. SIP-45は、k x RGPより高いガス価格に対してコンセンサス送信を増幅します(kは現在の設定で5に設定されているシステムパラメータで、RGPはreference gas priceです)。n x RGPのガス価格を持つトランザクションは、n倍増幅されます。
4. アプリ構築者とユーザーの両方による**SIP-45の幅広い採用**は、公正な競争を伴うより効率的なシステムを創出します。
   1. 重要なのは、SIP-45はクライアントの観点から基本的なシステム特性を変更しないことです:**より効率的な代替手段を提供することでスパムを抑制します**。

### トランザクションに適切なガス価格を選択する

クライアントが送信するトランザクションのガス価格を決定する際に考慮すべき2つの主要な要因があります:

1. **Priority gas auction**
   * コンセンサスコミット内では、同じObjectを変更するトランザクションは**ガス価格によって順序付け**られ、サーチャー間で公正な競争が生まれます。
2. **コンセンサス送信の増幅**
   * 上述のように、5 x RGPを超えるガス価格は、nバリデータが指定されたトランザクションをコンセンサスに送信することで**コンセンサス送信を増幅**します。増幅閾値を超えるガス価格の増加は、低パフォーマンスの送信ジッターの確率を減少させます。実際には、増幅係数5はジッターを排除するのに十分ですが、100 x RGPのガス価格は、高い確率で次のラウンドのリーダー送信をアンロックします。
3. **混雑による遅延とキャンセルの回避**
   * Suiは、同じShared Objectを変更するトランザクションのレートを制御することで、Checkpoint実行の実時間を制限します。混雑したObjectを変更するトランザクションは、ガス価格に従って順序付けられ、Checkpointごとの順次実行の最長チェーンを制限するために、低価格のトランザクションが遅延され、最終的にキャンセルされます。これは[**object-based local fee markets**](https://docs.sui.io/guides/developer/advanced/local-fee-markets?ref=blog.sui.io)と呼ばれるメカニズムです。*(高い裁定機会を提供するShared Objectに対してガス価格が急騰する可能性がありますが、システムの残りの部分では変わりません。)*
   * Full Nodeは、混雑したObjectを変更する実行済みおよびキャンセルされたトランザクションの両方のガス価格を追跡します。したがって、**トランザクションのドライランの結果**には、指定されたリクエストによって変更される混雑したObjectに対する、最低価格で実行されたトランザクションと最高価格でキャンセルされたトランザクションの両方のガス価格を含めることができます。この情報により、クライアントは高い確率で遅延を回避するために必要なガス価格を決定できます。*(なお、この作業は部分的に実装されており、今後2か月以内にSDKの一部となる予定です。)*

## トランザクション情報の配信

Sui上の各トランザクションは、潜在的な利益機会を伴う情報をもたらします。クライアントによって送信された時点から、その効果がサードパーティによって観察されるまでの、Shared Objectトランザクションのハッピーパスのライフサイクルを考えてみましょう:

![](https://blog.sui.io/content/images/2025/02/mermaid-diagram-2025-02-25-130957--1-.png)

1. クライアントがRPC Full Nodeにトランザクションを送信します(通常、アプリによって選択されます)。
2. RPCノードがトランザクションをバリデータにブロードキャストし、バリデータがその有効性を検証して署名し、RPCノードがクォーラムからトランザクション証明書を組み立てます。
3. RPCノードがトランザクション証明書をバリデータにブロードキャストします。
4. 決定論的に選択されたバリデータがトランザクションをコンセンサスに送信します。Mysticetiコンセンサスはバリデータ間でブロックをブロードキャストし、3コンセンサスラウンドで、指定されたトランザクションを含むブロックがコミットされます。
   1. トランザクションは各バリデータで実行されます
5. トランザクション効果証明書がRPCノードとクライアントに送り返されます。
6. 1〜3コンセンサスラウンド内に、各バリデータがCheckpointを形成して署名します(Checkpointはいくつかのコンセンサスコミットをバッチ処理します)。
7. Checkpoint署名がバリデータ間でブロードキャストされ、各バリデータがCheckpoint証明書を形成します。
8. state-syncプロトコルは、認証されたCheckpointをp2p方式で配信する責任があります。通常、各バリデータには、RPCリクエストを提供しない直接ピアがあります:state-sync Full Nodeで、最初にCheckpointを受信します。
9. state-sync Full Nodeに接続されているサードパーティのFull NodeがCheckpointについて知り、そのコンテンツをダウンロードします。この時点で、Full Nodeに直接接続されているサードパーティが、このトランザクションの効果を後処理し、それに応じて反応できると想定しています。

### バリデータ送信前のトランザクション情報の配信

前のセクションで説明したように、[SIP-19](https://github.com/sui-foundation/sips/blob/main/sips/sip-19.md?ref=blog.sui.io)に従ってsoft bundleを送信するためのSuiオフチェーンオークションがあります。これらのオークションは、**アプリとオークションシステム間のオフチェーン合意**を介してトランザクション送信を傍受します。例えば、[Shio](https://www.getshio.com/explorer?ref=blog.sui.io)が運営しているものです。

この種の情報配信は、潜在的なサンドイッチ攻撃からユーザートランザクションを保護する、行儀の良いオークションシステムを前提としています。Shioは、ビジネスを維持するためにユーザートランザクションを保護するインセンティブがあるため、潜在的なサンドイッチボットの財務的収益性を損なうために、多数のオークション技術(おとりトランザクション、ランダム遅延)を採用しています。

明らかに、この種の情報配信はSuiの外(アプリとオークションの間)で行われ、アプリとユーザーにとってオプトイン形式であり、投機的な情報のみを提供し、元のユーザートランザクションが成功する保証はありません。

### コンセンサスブロックのストリーミング

ユーザートランザクションへの低遅延アクセスを民主化するために、コンセンサスブロックの直接ストリーミングのためのシステムを設計しています。高レベルでは、Full Nodeはコンセンサスブロックに直接サブスクライブするオプションを持つことになります。

この方法により、Full Nodeは高い確率でコミットされるトランザクションについて投機的に通知するオプションを持つことができます。ネットワークトポロジは、標準的なオープンstate-syncピア検出プロトコルを使用しています。

投機的通知は、バリデータ送信から約160ミリ秒(2コンセンサスラウンド)に、トランザクションに関する伝播遅延を大幅に短縮する可能性があります。

コンセンサスブロックストリーミングプロジェクトは現在設計段階にあり、今後1〜2か月以内にSIPを作成する予定です。

## ユーザートランザクションの保護

ユーザートランザクションは、略奪的なフロントランニング、サンドイッチ、非自発的な送信遅延から保護される必要があります。

### 外部クォーラム駆動

Suiトランザクション送信には、通常Full Nodeによって実行される外部クォーラム駆動が必要です。

![](https://blog.sui.io/content/images/2025/02/image.png)

トランザクションtのトランザクション送信リクエストを受信したバリデータが新しいトランザクションt'を開始したい場合、証明書組み立てプロセスにおいて元のクォーラムドライバーより遅れることになります。送信するFull NodeがSuiクォーラムに不十分に接続されていない限り、元のトランザクションに応答してt'のクォーラム駆動を開始するバリデータは、tの後に証明書を組み立てることになります。

さらに、tのコンセンサス送信は分散化されているため、その証明書がクォーラムに到達すると、信頼性をもって延期することはできません。したがって、tの証明書がt'の証明書の前にSuiクォーラムに到達した場合、tは高い確率でt'の前に決済されます。

したがって、外部クォーラム駆動という事実そのものが、トランザクション送信を担当するFull Nodeへの信頼を前提として、自然なフロントランニング保護を提供します(フロントランニングの略奪的試みはオンチェーンで容易に検出されるため、これらの試みはクライアントによって記録され、RPCオペレーターの評判を傷つけます)。

### Mysticeti fast path

私たちは現在、Mysticeti [paper](https://arxiv.org/abs/2310.14821?ref=blog.sui.io)で説明されているfast pathプロトコルにトランザクション送信を変更するプロジェクトに取り組んでいます。このプロトコルによれば、ユーザートランザクションは単一のバリデータに送信でき、バリデータはMysticetiを活用してトランザクション証明書を収集および実行します。システムを大幅に効率的にする一方で、ユーザートランザクションを受信するバリデータにフロントランニングの機会を開きます。

このリスクは純粋に仮説的なものです。現在、Sui上でフロントランニングの試みの証拠はありません。新しいセットアップでは、フロントランニングの可能性は高くなりますが、一方で、送信するバリデータに関する決定論的な知識があるため、バリデータに責任を持たせることが容易になります。

## Suiの進化するMEVランドスケープ

SuiのMEVランドスケープはまだ形成途中であり、今年後半に新しいメカニズムが登場します。priority gas auctionsとコンセンサス増幅が現在のシステムを定義している一方で、タイムロック暗号化やMysticetiのfast pathなどの今後のイノベーションは、トランザクション実行とセキュリティを再構築します。これらの要素がオンラインになるにつれて、Sui上のMEVは進化を続け、よりダイナミックで透明性の高いエコシステムを創出します。
